databaseChangeLog:

  - changeSet:
      id: "constraints_1"
      author: danila_rudenko
      preConditions:
        - onFail: MARK_RAN
      changes:
        - addForeignKeyConstraint:
            baseTableName: cards
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_cards_user
        - sql:
            sql: |
              ALTER TABLE cards
              ADD CONSTRAINT chk_cards_balance_nonnegative CHECK (balance >= 0);
        - sql:
            sql: |
              ALTER TABLE cards
              ADD CONSTRAINT chk_cards_number_format CHECK (card_number ~ '^[0-9]{16}$');


  - changeSet:
      id: "constraints_2"
      author: danila_rudenko
      preConditions:
        - onFail: MARK_RAN
      changes:

        - addForeignKeyConstraint:
            baseTableName: card_requests
            baseColumnNames: card_id
            referencedTableName: cards
            referencedColumnNames: id
            constraintName: fk_card_requests_card

        - addForeignKeyConstraint:
            baseTableName: card_requests
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_card_requests_user