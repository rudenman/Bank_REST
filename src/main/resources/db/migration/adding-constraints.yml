databaseChangeLog:
  - changeSet:
      id: 9
      author: danila_rudenko
      preConditions:
        - onFail: MARK_RAN
      changes:
        - addForeignKeyConstraint:
            baseTableName: users
            baseColumnNames: role_id
            referencedTableName: roles
            referencedColumnNames: id
            constraintName: fk_users_role
        - addForeignKeyConstraint:
            baseTableName: users
            baseColumnNames: status_id
            referencedTableName: user_status
            referencedColumnNames: id
            constraintName: fk_users_status


  - changeSet:
      id: 10
      author: danila_rudenko
      preConditions:
        - onFail: MARK_RAN
      changes:
        - addForeignKeyConstraint:
            baseTableName: cards
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_cards_user
        - addForeignKeyConstraint:
            baseTableName: cards
            baseColumnNames: status_id
            referencedTableName: card_status
            referencedColumnNames: id
            constraintName: fk_cards_status
        - sql:
            sql: |
              ALTER TABLE cards
              ADD CONSTRAINT chk_cards_balance_nonnegative CHECK (balance >= 0);
        - sql:
            sql: |
              ALTER TABLE cards
              ADD CONSTRAINT chk_cards_number_format CHECK (card_number ~ '^[0-9]{16}$');


  - changeSet:
      id: 11
      author: danila_rudenko
      preConditions:
        - onFail: MARK_RAN
      changes:

        - addForeignKeyConstraint:
            baseTableName: card_requests
            baseColumnNames: card_id
            referencedTableName: cards
            referencedColumnNames: id
            constraintName: fk_card_requests_card

        - addForeignKeyConstraint:
            baseTableName: card_requests
            baseColumnNames: user_id
            referencedTableName: users
            referencedColumnNames: id
            constraintName: fk_card_requests_user

        - addForeignKeyConstraint:
            baseTableName: card_requests
            baseColumnNames: request_type_id
            referencedTableName: request_types
            referencedColumnNames: id
            constraintName: fk_card_requests_request_type

        - addForeignKeyConstraint:
            baseTableName: card_requests
            baseColumnNames: status_id
            referencedTableName: request_statuses
            referencedColumnNames: id
            constraintName: fk_card_requests_status